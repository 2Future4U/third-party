---

copyright:

  years: 2017, 2019

lastupdated: "2019-06-05"

keywords: Q P, offering usage, metering service, configuration, metering model, daily proration 

subcollection: third-party

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:screen: .screen}
{:tip: .tip}

# 計量の統合
{: #meteringintera}

{{site.data.keyword.Bluemix}} は、オファリング使用量を集計するための複数のモデルをサポートしています。 オファリング・プロバイダーは、プロビジョン済みインスタンスの各種メトリックを測定し、それらの測定値を計量サービスに送信します。 レーティング・サービスは、そのオファリング・プロバイダーが選択したモデルに基づいて、送信された使用量をさまざまなバケット (インスタンス、リソース・グループ、およびアカウント) に集計します。 プラン内のすべてのメトリックの集計およびレーティングのモデルは、そのプランの計量およびレーティングの定義文書に含まれています。
{:shortdesc}

以下のリストでは、使用量のトラッキングおよび送信に関する決まりごとについて説明しています。

*	第三者オファリング・プロバイダーは、無料プランの使用量を送信する必要はありません。
*	第三者オファリング・プロバイダーは、月決めサブスクリプション・プランの使用量を送信する必要はありません。
*	従量制プランの場合、すべてのオファリング・プロバイダーは使用量を毎時送信する必要があります (ライト・プランでは、15 分から 1 時間ごとに送信する必要があります)。
*	オファリング・プロバイダーには、失敗応答の再試行の自動化を含め、使用量送信を自動化する責任があります。 {{site.data.keyword.Bluemix_notm}} では、失敗した送信の再試行機能を提供していません。 詳しくは、[使用量記録の送信](/docs/third-party?topic=third-party-submitusage#usage-records)にある状況コードとアクションの表を参照してください。
*	当月の使用量記録は、遅くとも翌月の 2 日までに送信する必要があります。
*	{{site.data.keyword.Bluemix_notm}} は、月次請求処理サイクル用に構成されており、時刻は協定世界時 (UTC) で表されます。
*  オファリング・プロバイダーは、使用量送信をテストし、その結果を検証して月次請求処理サイクルの計算方法を通知する必要があります。

料金に関する一般的な情報については、[コストの計算方法](/docs/billing-usage?topic=billing-usage-cost#cost)を参照してください。 

## 構成プロパティー
{: #configure}

以下のプロパティーは、オファリング・プランの使用量送信の計量およびレーティングの方法を定義します。

<dl>
<dt>単位</dt>
<dd>計量されるメトリック。例えば、ApiCall、Bytes、Hours、Instances、および Nodes など。</dd>
<dt>集計</dt>
<dd>計量される単位データのコンパイル方法。例えば、INSTANCES_BY_MONTH、または ACTIVE_HOURS_BY_MONTH など。</dd>
<dt>計量モデル</dt>
<dd>以下の表に示すように、使用量送信データの処理方法。</dd>
<dt>リソース名</dt>
<dd>測定されるリソースの名前。例えば、storage、instance、virtual server、または bytes transmitted など。</dd>
<dt>単位名</dt>
<dd>デフォルト名がオファリングに関係ない場合、単位の記述名。</dd>
</dl>

## 計量モデルのタイプ
{: #metermodel}

以下の表は、使用可能な計量モデルを示しています。

|  タイプ | 説明  |
|-----|-----|
| standard_add | 1 カ月間のすべての送信済み使用量記録の量を加算します。 | 
| standard_max  | 1 カ月間のすべての送信済み使用量記録の最大量。 | 
| standard_avg | 1 カ月間のすべての送信済み使用量記録の平均量。 |
| dailyproration_max | 計算された 1 日の最大量。 1 カ月のすべての日を合計します。 | 
| dailyproration_avg | 計算された 1 日の平均量。 1 カ月のすべての日を合計します。 |
| monthlyproration | 1 日の比例配分と同様に計算されますが、使用される料金は、その月の合計日数でプラン料金を割ったもの (1 日の料金) です。 |
{: caption="表 1. 計量モデル" caption-side="top"}

### 例
{: #examples}

以下の各例のダッシュボード内の数量は、次の使用量が送信される前で、かつ現在の使用量が処理された後であることに注意してください。

#### Standard Add
{: #standard-add}

以下の表は、1 カ月全体の使用量の計算方法を示しています。

公式: ADD(usages)

| 時刻            | 提出された使用量 | 計算 | ダッシュボードの量 |
|-----------------|:-------------:| ----------- |:---------------------:|
| Day 1 (morning) | 5             | 5           | 5                     |
| Day 1 (night)   | 5             | 5 + 5       | 10                    |
| Day 2 (morning) | 5             | 10 + 5      | 15                    |
| Day 3 (morning) | 5             | 15 + 5      | 20                    |
| Day 4 (night)   | 5             | 20 + 5      | 25                    |
{: caption="表 2. 月々の使用量の計算" caption-side="top"}

#### Standard Average
{: #standard-average}

以下の表は、1 カ月全体の使用量の平均を計算する方法を示しています。ゼロ使用量の送信も、平均にカウントされることに注意してください。

公式: AVG(usages)

| 時刻            | 提出された使用量 | 計算             | ダッシュボードの量 |
|-----------------|:-------------:| ----------------------- |:---------------------:|
| Day 1 (morning) | 4             | 4 / 1                   | 4                     |
| Day 1 (night)   | 0             | (4 + 0) / 2             | 2                     |
| Day 2 (morning) | 5             | (4 + 0 + 5) / 3         | 3                     |
| Day 3 (morning) | 3             | (4 + 0 + 5 + 3) / 4     | 3                     |
| Day 4 (night)   | 3             | (4 + 0 + 5 + 3 + 3) / 5 | 3                     |
{: caption="表 3. 月々の使用量の平均の計算" caption-side="top"}

#### Standard Max
{: #standard-max}

以下の表は、1 カ月全体の使用量の最大を計算する方法を示しています。

公式: MAX(usages)

| 時刻            | 提出された使用量  | 計算  | ダッシュボードの量 |
|-----------------|:--------------:| ------------ |:---------------------:|
| Day 1 (morning) | 5              | MAX(5)       | 5                     |
| Day 1 (night)   | 10             | MAX(5, 10)   | 10                    |
| Day 2 (morning) | 0              | MAX(10, 0)   | 10                    |
| Day 3 (morning) | 15             | MAX(10, 15)  | 15                    |
| Day 4 (night)   | 1              | MAX(15, 1)   | 15                    |
{: caption="表 4. 月々の使用量の最大の計算" caption-side="top"}

#### Daily proration Average
{: #proration-average}

毎日の平均使用量を計算し、その月の平均値を出します。 それぞれの日の平均値を加算し、現在の経過日数 (UTC 単位) で割ります。

公式: 総計(1 日の平均) / 請求処理期間の経過日数

数量は 1 カ月の間に変化する可能性がありますが、レーティングの対象は 1 日当たりの平均使用量になります。

1 カ月の日数が 30 日の場合、1 日の比例配分平均の計算は以下の表のようになります。

| 時刻               | 提出された使用量    | 1 日の平均 | 計算                            | ダッシュボードの量*                           |
| ------------------ | :--------------: | ------------- | ------------------                     | :----------------------------------------------: |
| Day 1 (morning)    | 8                | 8 / 1         | 8 / 1                                  | 8                                                |
| Day 1 (night)      | 3                | (8 + 3) / 2   | 5.5 / 1                                | 5.5 (Day 1 の EOD)                               |
| Day 2 (morning)    | 2                | 2 / 1         | (5.5 + 2) / 2                          | 3.75                                             |
| Day 2 (night)      | 5                | (2 + 5) / 2   | (5.5 + 3.5) / 2                        | 4.5 (Day 2 の EOD)                               |
| Day 3 から Day 15    | 1                | 1 / 1         | (5.5 + 3.5 + (1 + 13)  / 15            | 1.4666  (Day 15 の EOD)                          |
| Day 15 から Day 30   | 0                | 0 / 1         | (5.5 + 3.5 + (1 \* 12) + (0  \* 15) / 30 | 0.7333  (Day 30 の EOD)                          |
{: caption="表 5. 1 日当たりの使用量の平均と月々の平均の計算" caption-side="top"}

\* 使用量が送信された日と同日に確認。

#### Daily proration Max
{: #daily-proration}

1 日当たりの最大使用量を計算し、その月の平均を出します。 毎日の最大値を加算し、現在の経過日数 (UTC 単位) で割ります。

公式: 総計(1 日の最大) / 請求処理期間内の経過日数

数量は 1 カ月の間に変化する可能性がありますが、レーティング対象は、1 日当たりの最大使用量になります。

1 カ月の日数が 30 日の場合、1 日当たりの最大使用量と月々の平均の計算は以下の表のようになります。

| 時刻             | 提出された使用量  | 1 日の最大 | 計算                    | ダッシュボードの量* |
|------------------|:--------------:| --------- | ------------------------------ |:----------------------:|
| Day 1 (morning)  | 0              | MAX(0)    | 0 / 1                          | 0                      |
| Day 1 (night)    | 1              | MAX(0, 1) | 1 / 1                          | 1                      |
| Day 2 から Day 15  | 1              | MAX(1)    | (1 + 1 + ...) / day            | 1                      |
| Day 15 から Day 30 | 0              | MAX(0)    | (1 + (1 * 14) + 0 + ...) / day | < 1                    |
{: caption="表 6. 1 日当たりの最大使用量と月々の平均の計算" caption-side="top"}

\* 使用量が送信された日と同日に確認。

## 計量およびレーティングのスケールの例
{: #scale-examples}

スケーリング構成を使用して、使用量送信で提出されるものから、使用状況ダッシュボードに表示されるもの、およびレーティングとコストの計算に使用されるものとは異なる方法で単位量をコンパイルすることができます。 以下の例は、これらのシナリオを示しています。

### ユーザーに表示される数字よりも細分性を高めたい
{: #users}

より細分化したレベルで使用量を送信したいが、お客様には、より分かりやすい数字を示したい。

例えば、インスタンスのトラフィックをバイト単位で測定し、集計値をメガバイト単位で表示したい場合があります。 これを実行するには、`scale` 1024 を**計量 (metering) **構成に追加します。

### 料金構成よりも細分性を高めたい
{: #pricing-configuration}

メトリックの料金を $X / ギガバイトとして設定しているが、それらをメガバイト単位で送信したい。 メトリックの料金設定は $1 / ギガバイトだが、ユーザーが 0.5 メガバイトを使用した場合、料金設定が 1 ギガバイト当たりのため、ユーザーは $1 課金されます。 `scale` 1024 を **レーティング (rating) **構成に追加し、`clip` を `true` に設定します。

こうすると、メトリックの料金設定が同様に 100 個の API 呼び出し (または何か他のパック・サイズ) 当たり $X となっている場合、true が保持されます。

### 計量レベルとレーティング・レベルの両方をスケーリングしたい
{: #metering-rating}

計量構成とレーティング構成の両方にスケーリングを追加できます。 提出はバイト単位で行いたいが、ユーザーにはメガバイト単位で表示したい場合は、計量スケールを 1024 になるように構成します。 メトリック料金がギガバイト単位の場合は、レーティング・スケールも 1024 になるように構成します。

## 料金モデル
{: #pricing}

以下の表に、使用可能な料金モデルの詳細を示します。 使用可能なメトリックの多くで、関連付けられている料金モデルを選択します。

| モデル          | 説明 | 計算 | 例 (5000 の数量) |
|:-----------------|:-------------|:----------- |:---------------------|
| Linear         | リソース当たりの単価 (P) を使用量 (Q) で掛けて、合計金額 (T) を出します  | P*Q    | P=$1 T=1*5000 =$5000        |
| Proration      | リソース当たりの 1 日の単価 (P) を 1 日の使用量 (Q) で掛けて、1 日の合計金額を出します。 合計請求額では、月内のすべての日の請求額の累積を行います。         | T= (pd * Q1) + ...+(Pd *Qn)     | <ul><li>P= $30</li><li>Pd (1 日当たりの料金) =$30/30=$1 (1 カ月の日数を 30 日と想定)</li><li>T1= $1 * 1 =$1</li><li>T2 = $1 * 0 =$0</li><li>Tn = 1 * 1 =$1</li><li>T = $1 + $0 +...+$1 = $5000</li></ul>     |
| Simple tier (granular tier)  | 全消費量の単価が、数量が分類される層によって決まる P*Q モデル。           | <ul><li>Q が <=Q1 の場合、T=P1*Q</li><li>Q1 < Q <=Q2 の場合、T=P2*Q</li><li>Q2 < Q <=Q3 の場合、T=P3*Q</li></ul>     |   <ul><li>Q1=1000、P1=$1</li><li>Q2=2500、P2=$0.9</li><li>Q3=10000、P3=$0.75</li><li>T=$0.75*5000=$3750</li></ul>              |
| Graduated tier (step tier)   | 1 単位当たりの料金は、消費量が、さまざまな事前定義層に移動するにつれて変化します。 合計請求額の計算では、前の層からの請求額の累積を行います。           | <ul><li>T1=P1*Q (0 < Q</li><li>Q1 < Q <=Q2 の場合、T=T2</li><li>Q2 < Q <=Q3 の場合、T=T3</li></ul>     | <ul><li>Q1=1000、P1=$1、T1=1*1000</li><li>Q2=1500、P2=$0.9、T2=0.9*1500</li><li>Q3=10000、P3=$0.75、T3=0.75*2500</li><li>T=1000 +1350+1875=$4225</li></ul>          |
| Block tier (up to)           | 請求される合計金額は、ブロック内で変化しない「上限 (up to)」量によって確立されます     | <ul><li>Q が <=Q1 の場合、T=T1</li><li>Q1 < Q <=Q2 の場合、T=T2</li><li>Q2 < Q <=Q3 の場合、T=T3</li></ul>    |  <ul><li>Q1=1000、T1=$0</li><li>Q2=2500、T2=2500</li><li>Q3=10000、T3=$4500</li><li>T=$4500</li></ul>            |
{: caption="表 7. 料金モデル" caption-side="top"}

