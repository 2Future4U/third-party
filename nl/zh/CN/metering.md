---


copyright:

  years: 2017, 2018

lastupdated: "2018-06-21"

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:screen: .screen}
{:tip: .tip}

# 计量集成
{: #meteringintera}

{{site.data.keyword.Bluemix}} 支持多个模型用于聚集产品使用量。产品提供者度量所供应实例的各种度量值，并将这些度量提交给计量服务。费率服务根据产品提供者选择的模型，将所提交的使用量聚集到不同的存储区（实例、资源组和帐户）。套餐中所有度量值的聚集和费率模型包含在套餐的计量和费率定义文档中。
{:shortdesc}

以下列表描述了对跟踪和提交使用量的预期：

*	第三方产品提供者无需提交免费套餐的使用量。
*	第三方产品提供者无需提交每月预订套餐的使用量。
*	对于计量套餐，所有产品提供者必须每小时提交一次使用量（轻量套餐每 15 分钟到 1 小时提交一次）。
*	产品提供者负责自动执行使用量提交，包括再次尝试失败响应的自动提交。{{site.data.keyword.Bluemix_notm}} 没有为失败的提交提供重试功能。有关更多信息，请参阅[提交使用量记录](/docs/third-party/submitusage.html#submitting-usage-records)中的状态码和操作表。
*	当月的使用量记录必须最迟在下个月的第 2 天提交。
*	{{site.data.keyword.Bluemix_notm}} 是针对每月计费周期配置的，时间以 UTC 表示。
*  产品提供者必须测试使用量提交，并验证其结果以了解如何计算每月计费周期。

有关定价的常规信息，请参阅[如何计算成本](https://console.bluemix.net/docs/billing-usage/estimating_costs.html#cost)。

## 配置属性
{: #configure}

以下属性定义如何对产品套餐的使用量提交进行计量并确定费率：

<dl>
<dt>单位</dt>
<dd>要计量的度量值，例如 ApiCall、字节数、小时数、实例数和节点数。</dd>
<dt>聚集</dt>
<dd>如何汇集计量单位数据，例如 INSTANC_BY_MONTH 或 ACTIVE_HOURS_BY_MONTH。</dd>
<dt>计量模型</dt>
<dd>如何处理使用量提交数据，如下表中所示。</dd>
<dt>资源名称</dt>
<dd>所度量的资源（例如，存储器、实例、虚拟服务器或传输的字节数）的名称。</dd>
<dt>单位名称</dt>
<dd>单位的描述性名称（如果缺省名称与产品无关）。</dd>
</dl>

## 计量模型类型
{: #metermodel}

下表显示了可用的计量模型。

|类型|描述
|
|-----|-----|
|standard_add|根据一个月的所有提交的使用量记录添加数量。| 
|standard_max|一个月的所有提交的使用量记录中的最大数量。| 
|standard_avg|一个月的所有提交的使用量记录中的平均数量。|
|dailyproration_max|计算的每日最大值。合计一个月的所有天数。| 
|dailyproration_avg|计算的每日平均值。合计一个月的所有天数。|
|monthlyproration|计算类似于每日按比例分配，但使用的价格是套餐价格除以一个月的总天数（每日价格）。|
{: caption="表 1. 计量模型" caption-side="top"}

### 示例
请注意，以下每个示例中仪表板中的数量等于处理当前使用量之后但在下一次使用量提交之前这段时间的数量。

#### 标准添加
计算整月的使用量。

公式：ADD(使用量)

|时间|提交的使用量|计算|仪表板中的数量|
|-----------------|:-------------:| ----------- |:---------------------:|
|第 1 天（早上）|5|5|5|
|第 1 天（晚上）|5|5+ 5|10|
|第 2 天（早上）|5|10+ 5|15|
|第 3 天（早上）|5|15 + 5|20|
|第 4 天（晚上）|5|20+ 5|25|

#### 标准平均值
计算整月的平均使用量。请注意，提交零使用量也会计入平均值。

公式：AVG(使用量)

|时间|提交的使用量|计算|仪表板中的数量|
|-----------------|:-------------:| ----------------------- |:---------------------:|
|第 1 天（早上）|4|4 / 1|4|
|第 1 天（晚上）|0|(4 + 0) / 2|2|
|第 2 天（早上）|5|(4 + 0 + 5) / 3|3|
|第 3 天（早上）|3|(4 + 0 + 5 + 3) / 4|3|
|第 4 天（晚上）|3|(4 + 0 + 5 + 3 + 3) / 5|3|

#### 标准最大值
计算整月的最大使用量。

公式：MAX(使用量)

|时间|提交的使用量|计算|仪表板中的数量|
|-----------------|:--------------:| ------------ |:---------------------:|
|第 1 天（早上）|5|MAX(5)|5|
|第 1 天（晚上）|10|MAX(5, 10)|10|
|第 2 天（早上）|0|MAX(10, 0)|10|
|第 3 天（早上）|15|MAX(10, 15)|15|
|第 4 天（晚上）|1|MAX(15, 1)|15|

#### 每日按比例分配平均值
计算每天的平均使用量，并计算一个月的平均值。每天的平均值将相加并除以当前经过的天数（以 UTC 表示)。

公式：Summation(每日平均值) / 结算周期中经过的天数

请注意，数量可能在整个月内会变化，但确定费率的对象是每天平均使用量。

假设一个月有 30 天：

|时间|提交的使用量|每日平均值|计算|仪表板中的数量*|
| ------------------ | :--------------: | ------------- | ------------------                     | :----------------------------------------------: |
|第 1 天（早上）|8|8 / 1|8 / 1|8|
|第 1 天（晚上）|3|(8 + 3) / 2|5.5 / 1|5.5（第 1 天结束时）|
|第 2 天（早上）|2|2 / 1|(5.5 + 2) / 2|3.75|
|第 2 天（晚上）|5|(2 + 5) / 2|(5.5 + 3.5) / 2|4.5（第 2 天结束时）|
|第 3 天到第 15 天|1|1 / 1|(5.5 + 3.5 + (1 + 13) / 15|1.4666（第 15 天结束时）|
|第 15 天到第 30 天|0|0 / 1|(5.5 + 3.5 + (1 * 12) + (0 * 15) / 30|0.7333（在第 30 天结束时）|

\* 在提交使用量的当天显示的数量。

#### 每日按比例分配最大值
计算每天的最大使用量，并计算一个月的平均值。每天的最大值将相加并除以当前经过的天数（以 UTC 表示)。

公式：Summation(每日最大值) / 结算周期中经过的天数

请注意，数量可能在整个月内会变化，但确定费率的对象是每天最大使用量。

假设一个月有 30 天：

|时间|提交的使用量|每日最大值|计算|仪表板中的数量*|
|------------------|:--------------:| --------- | ------------------------------ |:----------------------:|
|第 1 天（早上）|0|MAX(0)|0 / 1|0|
|第 1 天（晚上）|1|MAX(0, 1)|1 / 1|1|
|第 2 天到第 15 天|1|MAX(1)|(1 + 1 + ...) / 天|1|
|第 15 天到第 30 天|0|MAX(0)|(1 + (1 * 14) + 0 + ...) / 天|< 1|

\* 在提交使用量的当天显示的数量。

## 计量和费率档位示例
{: #scale-examples}

您可以使用档位配置来以不同方式汇集单位数量：在提交使用量时发送的数量、在“使用情况仪表板”中显示的使用量，以及最终用于确定费率和成本计算的内容。以下示例演示了应该配置这些值的方案：

### 您需要的详细程度高于用户看到的详细程度
您希望以更详细的级别发送使用量，但希望向客户显示的是更便于阅读的数字。

例如，您可能希望度量实例的流量（以字节为单位），并需要聚集值（以兆字节为单位）。为此，您向**计量**配置添加了值为 1024 的 `scale`。

### 您需要的详细程度高于定价配置的详细程度
您将度量值定价为 X 美元/千兆字节，但希望发送这些值时以兆字节为单位。如果度量值定价为 1 美元/千兆字节，但用户使用了 0.5 兆字节，那么由于您的定价是以千兆字节为单位的，因此将向用户收取 1 美元。您向**费率**配置添加了值为 1024 的 `scale`，并将 `clip` 设置为 `true`。

如果度量值定价为每 100 个 API 调用（或其他某个包大小）X 美元，那么这种情况成立。

### 您希望在计量级别和费率级别同时增加档位
您可以向计量和费率配置添加档位。如果要以字节为单位发送，但要向用户显示兆字节，请将计量档位配置为 1024。如果度量值价格以千兆字节为单位，那么还要将费率档位配置为 1024。

## 定价模型
{: #pricing}

下表提供了有关可用的定价模型的详细信息。对于许多可用的度量值，您可以选择关联的定价模型。

|模型| 描述 |计算|示例（数量为 5000）|
|:-----------------|:-------------|:----------- |:---------------------|
|线性|将每个资源的单价 (P) 乘以使用数量 (Q) 等于总金额 (T)|P*Q|P=$1 T=1*5000 =$5000|
|按比例分配|将每个资源的每日单价 (P) 乘以每日使用数量 (Q) 等于每日总金额。总费用涉及累计给定月份内所有天数的费用。|T= (pd * Q1) + ...+(Pd *Qn)| <ul><li>P= $30</li><li>Pd（每日价格）=$30/30=$1（假定一个月有 30 天）</li><li>T1= $1 * 1 =$1</li><li>T2 = $1 * 0 =$0</li><li>Tn = 1 * 1 =$1</li><li>T = $1 + $0 +...+$1 = $5000</li></ul>     |
|简单层（详细层）|P*Q 模型，其中所有使用量的单价由数量所属的层确定。| <ul><li>如果 Q <=Q1，那么 T=P1*Q</li><li>如果 Q1 < Q <=Q2，那么 T=P2*Q</li><li>如果 Q2 < Q <=Q3，那么 T=P3*Q</li></ul>     |   <ul><li>Q1=1000, P1=$1</li><li>Q2=2500, P2=$0.9</li><li>Q3=10000, P3=$0.75</li><li>T=$0.75*5000=$3750</li></ul>              |
|累进层（步骤层）|在所用数量移至不同的预定义层时，单价会有所变化。总费用涉及累计先前层中的费用| <ul><li>T1=P1*Q (0 < Q</li><li>如果 Q1 < Q <=Q2，那么 T=T2</li><li>如果 Q2 < Q <=Q3，那么 T=T3</li></ul>     | <ul><li>Q1=1000, P1=$1, T1=1*1000</li><li>Q2=1500, P2=$0.9, T2=0.9*1500</li><li>Q3=10000, P3=$0.75, T3=0.75*2500</li><li>T=1000 +1350+1875=$4225</li></ul>          |
|包量层（最多）|所收取的总金额由在该包量范围内不会变化的“最多”数量确定| <ul><li>如果 Q 为 <=Q1，那么 T=T1</li><li>如果 Q1 < Q <=Q2，那么 T=T2</li><li>如果 Q2 < Q <=Q3，那么 T=T3</li></ul>    |  <ul><li>Q1=1000, T1=$0</li><li>Q2=2500, T2=2500</li><li>Q3=10000, T3=$4500</li><li>T=$4500</li></ul>            |


