---

copyright:

  years: 2017, 2019

lastupdated: "2019-06-05"

keywords: Q P, offering usage, metering service, configuration, metering model, daily proration 

subcollection: third-party

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:screen: .screen}
{:tip: .tip}

# 計量整合
{: #meteringintera}

{{site.data.keyword.Bluemix}} 支援多種模型以便聚集供應項目用量。供應項目提供者會測量已佈建實例的各種度量值，並將這些測量值提交給計量服務。分級服務會根據供應項目提供者所選擇的模型，將已提交的用量聚集到不同的儲存區（實例、資源群組及帳戶）。方案中所有度量值的聚集及分級模型包含在方案的計量及分級定義文件中。
{:shortdesc}

下列清單說明對於追蹤及提交用量的預期：

*	協力廠商供應項目提供者不需要提交免費方案的用量。
*	協力廠商供應項目提供者不需要提交每月訂閱方案的用量。
*	對於計量方案，所有供應項目提供者都必須每小時提交用量（精簡方案必須每 15 分鐘到 1 小時提交一次）。
*	供應項目提供者負責將用量提交自動化（包括重新嘗試失敗回應的自動化）。{{site.data.keyword.Bluemix_notm}} 不會提供失敗提交的重試功能。如需相關資訊，請參閱[提交用量記錄](/docs/third-party?topic=third-party-submitusage#usage-records)中的狀態碼及動作表。
*	最晚必須在下個月的 2 號之前提交現行月份的用量記錄。
*	{{site.data.keyword.Bluemix_notm}} 配置為按月計費週期，而且時間以世界標準時間 (UTC) 表示。
*  供應項目提供者必須測試用量提交，並驗證其結果，以通知如何計算按月計費週期。

如需定價的一般資訊，請參閱[如何計算成本](/docs/billing-usage?topic=billing-usage-cost#cost)。 

## 配置內容
{: #configure}

下列內容定義如何計量及分級供應項目方案的用量提交：

<dl>
<dt>單位</dt>
<dd>要計量的度量值，例如，ApiCall、「位元組」、「小時」、「實例」及「節點」。</dd>
<dt>聚集</dt>
<dd>如何編譯計量單位資料，例如 INSTANCES_BY_MONTH 或 ACTIVE_HOURS_BY_MONTH。</dd>
<dt>計量模型</dt>
<dd>如何處理用量提交資料，如下表所示。</dd>
<dt>資源名稱</dt>
<dd>正在測量的資源名稱，例如，儲存空間、實例、虛擬伺服器或傳輸的位元組。</dd>
<dt>單位名稱</dt>
<dd>單位的敘述性名稱（如果預設名稱與供應項目不相關）。</dd>
</dl>

## 計量模型類型
{: #metermodel}

下表顯示可用的計量模型。

|類型|說明|
|-----|-----|
| standard_add |加上某個月所有已提交用量記錄中的數量。| 
| standard_max  |某個月所有已提交用量記錄中的最大數量。| 
| standard_avg | 某個月所有已提交用量記錄中的平均數量。|
| dailyproration_max |計算而得的每日最大值。加總該月的所有日期。| 
| dailyproration_avg |計算而得的每日平均值。加總該月的所有日期。|
| monthlyproration |類似每日比例分配而進行計算，但使用的價格是方案價格除以該月的總天數（每日價格）。|
{: caption="表 1. 計量模型" caption-side="top"}

### 範例
{: #examples}

請注意，下列所有範例之儀表板中的數量，是在提交下一個用量之前但在處理現行用量之後的數量。

#### 標準相加
{: #standard-add}

下表提供如何計算整個月用量的相關資訊。

公式：ADD(用量)

| 時間            | 送入的用量    | 計算        | 儀表板中的數量        |
|-----------------|:-------------:| ----------- |:---------------------:|
| 第 1 天（早上） | 5             | 5             | 5                |
| 第 1 天（晚上） | 5             | 5 + 5       |10|
| 第 2 天（早上） | 5             | 10 + 5      | 15                    |
| 第 3 天（早上） | 5             | 15 + 5      |20 |
| 第 4 天（晚上） | 5             | 20 + 5      | 25                    |
{: caption="表 2. 每月用量計算" caption-side="top"}

#### 標準平均值
{: #standard-average}

下表提供如何計算整個月平均用量的相關資訊。請注意，提交零用量也會計入平均值。

公式：AVG(用量)

| 時間            | 送入的用量    | 計算                    | 儀表板中的數量        |
|-----------------|:-------------:| ----------------------- |:---------------------:|
| 第 1 天（早上） | 4                     | 4 / 1                   | 4                     |
| 第 1 天（晚上） | 0             | (4 + 0) / 2             | 2                     |
| 第 2 天（早上） | 5             | (4 + 0 + 5) / 3         | 3                     |
| 第 3 天（早上） | 3                     | (4 + 0 + 5 + 3) / 4     | 3                     |
| 第 4 天（晚上） | 3                     | (4 + 0 + 5 + 3 + 3) / 5 | 3                     |
{: caption="表 3. 每月用量平均值計算" caption-side="top"}

#### 標準最大值
{: #standard-max}

下表提供如何計算整個月最大用量的相關資訊。

公式：MAX(用量)

| 時間            | 送入的用量     | 計算         | 儀表板中的數量        |
|-----------------|:--------------:| ------------ |:---------------------:|
| 第 1 天（早上） | 5              | MAX(5)       | 5                |
| 第 1 天（晚上） |10| MAX(5, 10)   |10|
| 第 2 天（早上） | 0              | MAX(10, 0)   |10|
| 第 3 天（早上） | 15                    | MAX(10, 15)  | 15                    |
| 第 4 天（晚上） | 1              | MAX(15, 1)   | 15                    |
{: caption="表 4. 每月用量最大值計算" caption-side="top"}

#### 每日比例分配平均值
{: #proration-average}

計算每一天的平均用量，並計算它在該月份的平均值。每一天的平均值都會加總並除以目前經過的天數（以世界標準時間為準）。

公式：Summation(每日平均值)/計費期間中經過的天數

請注意，數量在整個月可能都會變更，但分級的內容是每天的平均用量。

若是 30 天的月份，請參閱下表以計算每日比例分配平均值：

| 時間               | 送入的用量       | 每日平均值    | 計算                                   | 儀表板中的數量*                                  |
| ------------------ | :--------------: | ------------- | ------------------                     | :----------------------------------------------: |
| 第 1 天（早上）    | 8                | 8 / 1                                  | 8 / 1                                  | 8                                                |
| 第 1 天（晚上）    | 3                | (8 + 3) / 2   | 5.5 / 1                                | 5.5（在第 1 天結束時）                             |
| 第 2 天（早上）    | 2                | 2 / 1         | (5.5 + 2) / 2                          | 3.75                                             |
| 第 2 天（晚上）    | 5                | (2 + 5) / 2   | (5.5 + 3.5) / 2                        | 4.5（在第 2 天結束時）                             |
| 第 3 天到第 15 天  | 1                | 1 / 1         | (5.5 + 3.5 + (1 + 13)  / 15            | 1.4666（在第 15 天結束時）                             |
| 第 15 天到第 30 天 | 0                | 0 / 1         | (5.5 + 3.5 + (1 \* 12) + (0  \* 15) / 30 | 0.7333（在第 30 天結束時）                             |
{: caption="表 5. 每日平均用量和每月平均值計算" caption-side="top"}

\* 如提交用量的同一天所見。

#### 每日比例分配最大值
{: #daily-proration}

計算每天的最大用量，並計算它在該月份的平均值。每一天的最大值都會加總並除以目前經過的天數（以世界標準時間為準）。

公式：Summation(每日最大值)/計費期間中經過的天數

請注意，數量在整個月可能都會變更，但分級的內容是每天的最大用量。

若是 30 天的月份，請參閱下表以計算每日最大用量和每月平均用量：

| 時間             | 送入的用量     |每日最大值| 計算                           | 儀表板中的數量*        |
|------------------|:--------------:| --------- | ------------------------------ |:----------------------:|
| 第 1 天（早上）  | 0              | MAX(0)    | 0 / 1                          | 0              |
| 第 1 天（晚上）  | 1              | MAX(0, 1) | 1 / 1                          | 1                      |
| 第 2 天到第 15 天| 1              | MAX(1)    | (1 + 1 + ...) /天              | 1                      |
| 第 15 天到第 30 天| 0              | MAX(0)    | (1 + (1 * 14) + 0 + ...) /天  | < 1                    |
{: caption="表 6. 每日用量最大值和每月平均值計算" caption-side="top"}

\* 如提交用量的同一天所見。

## 計量及分級尺度範例
{: #scale-examples}

您可以使用比例配置，將用量提交中所傳送的單位數量，以不同方式編譯為「用量儀表板」中所顯示之內容，以及用於分級及成本計算的內容。下列範例示範這些情境：

### 您想要比使用者所見內容更精細的內容
{: #users}

您想要傳送更精細的用量，但想要向客戶顯示更具可讀性的數目。

例如，您可能想要以位元組為單位測量實例的資料流量，並想要聚集的值是以 MB 為單位。若要這麼做，請將 `scale` 1024 新增至**計量**配置。

### 您想要比定價配置所具有內容更精細的內容
{: #pricing-configuration}

您將度量值定價為 $X/GB，但想要以 MB 為單位來傳送它們。如果您的度量值定價為 $1/GB，但使用者使用 0.5 MB，則因為是依每一 GB 定價，所以會向他們收取 $1 元。您可以將 `scale` 1024 新增至**分級**配置，並將 `clip` 設定為 `true`。

如果您的度量值也定價為每 100 個 API 呼叫（或某個其他封包大小）$X 元，則這同樣適用。

### 您想要同時以計量及分級層次為尺度
{: #metering-rating}

您可以將比例同時新增至計量及分級配置。如果您想要以位元組為單位來傳送，但向使用者顯示 MB，則請將計量尺度配置為 1024。如果度量值價格以 GB 為單位，則也請將分級尺度配置為 1024。

## 定價模型
{: #pricing}

下表提供可用定價模型的詳細資訊。針對許多可用的度量值，您可以選取相關聯的定價模型。

| 模型           |說明| 計算        | 範例（5000 數量）       |
|:-----------------|:-------------|:----------- |:---------------------|
| 線性           | 將每項資源的單價 (P) 乘上用量數量 (Q)，以取得總金額 (T) | P*Q    | P=$1 T=1*5000 =$5000        |
| 比例分配       | 將每項資源的每日單價 (P) 乘上每日用量數量 (Q)，以取得每日總金額。總費用涉及累計月份內所有日期的費用。| T= (pd * Q1) + ...+(Pd *Qn)     | <ul><li>P= $30</li><li>Pd (每日價格) =$30/30=$1（假設該月有 30 天）</li><li>T1= $1 * 1 =$1</li><li>T2 = $1 * 0 =$0</li><li>Tn = 1 * 1 =$1</li><li>T = $1 + $0 +...+$1 = $5000</li></ul>     |
|簡單層級（精細層級）| P*Q 模型，其中，所有耗用的單價都是由數量所在層級決定。| <ul><li>如果 Q 是 <=Q1，則 T=P1*Q</li><li>如果 Q1 < Q <=Q2，則 T=P2*Q</li><li>如果 Q2 < Q <=Q3，則 T=P3*Q</li></ul>     |   <ul><li>Q1=1000，P1=$1</li><li>Q2=2500，P2=$0.9</li><li>Q3=10000，P3=$0.75</li><li>T=$0.75*5000=$3750</li></ul>              |
|累進層級（間距層級）|每個單位的價格會隨著所耗用的數量進入不同預先定義層級而變。總費用涉及累計先前層級的費用。| <ul><li>T1=P1*Q (0 < Q</li><li>如果 Q1 < Q <=Q2，則 T=T2</li><li>如果 Q2 < Q <=Q3，則 T=T3</li></ul>     | <ul><li>Q1=1000，P1=$1，T1=1*1000</li><li>Q2=1500，P2=$0.9，T2=0.9*1500</li><li>Q3=10000，P3=$0.75，T3=0.75*2500</li><li>T=1000 +1350+1875=$4225</li></ul>          |
| 區塊層級（最多）                 |收取的總金額是由「最多」數量所建立，它在區塊內不會改變| <ul><li>如果 Q 是 <=Q1，則 T=T1</li><li>如果 Q1 < Q <=Q2，則 T=T2</li><li>如果 Q2 < Q <=Q3，則 T=T3</li></ul>    |  <ul><li>Q1=1000，T1=$0</li><li>Q2=2500，T2=2500</li><li>Q3=10000，T3=$4500</li><li>T=$4500</li></ul>            |
{: caption="表 7. 定價模型" caption-side="top"}

