---

 
copyright:

  years: 2017, 2018

lastupdated: "2018-09-05" 

---

{:shortdesc: .shortdesc}
{:codeblock: .codeblock}
{:screen: .screen}
{:tip: .tip}
{:new_window: target="_blank"}

# 측정량 기반 플랜을 위한 사용량 제출
{: #submitusage}

모든 활성 서비스 인스턴스에 대한 사용량을 매시간 제출해야 합니다. 사용량을 보고하지 않으면 IBM에 대한 수익 콜렉션이 손실될 수 있으며 이로 인해 오퍼링 제공자에 대한 수익 배당이 손실될 수 있습니다.
{:shortdesc}

## 프로세스 작동 방식
{: #process-flow}

다음 단계는 사용량을 제출하는 프로세스에 대한 개요입니다.

1. 사용량 제출 REST API 도구로 초기 사용량 테스트를 제출하여 측정량 기반 플랜이 올바르게 구성되었는지 검증합니다.
2. 각 측정량 기반 플랜에 대한 사용량 제출 재설정 API 도구에 매시간 계속해서 제출하도록 자동화합니다. 표준 SSO가 지원되는 한 어디서든 자동 제출을 호스팅할 수 있습니다.
2. 사용량 레코드는 측정 모델을 기반으로 집계되며, 총 수량은 {{site.data.keyword.Bluemix_notm}} 콘솔의 사용량 대시보드에 표시됩니다.
3. 측정 프로세스에서 집계된 단위 수량이 사용되고 비용이 적용되며 서비스 인스턴스에 대해 사용자가 지불해야 하는 금액이 계산됩니다.
4. 월말에 최종 계산되는 비용은 사용자에 대해 생성되는 금액입니다.

## 전제조건
{: #prereqs}

서비스에 측정을 사용하려면 다음 전제조건을 검토하십시오.

* 리소스 플랜의 모든 부과 가능한 메트릭에 대한 가격으로 가격 카탈로그가 업데이트됩니다.
* 리소스의 모든 플랜에 대한 측정 및 등급 지정 정의가 검증되고 온보드됩니다.

## 사용량 제출을 위한 가이드라인 
{: #metering_guidelines}

### 제출 가이드라인
{: #submission-guidelines}

{{site.data.keyword.Bluemix_notm}} 측정 서비스를 사용하여 리소스 사용량 데이터를 제출할 때 다음 가이드라인을 참조하십시오.

* 시작 시간 및 종료 시간은 측정값이 수집되는 시간 범위를 나타냅니다. 이 시간은 사용량 레코드가 측정 API에 제출되는 시간에 종속되지 않습니다.
* 사용량 레코드는 실제 정보입니다. 사용량 레코드를 작성한 후에는 업데이트하지 마십시오. 위치는 사용량 레코드를 성공적으로 작성하면 지정됩니다. 오류 코드가 리턴되면 수행해야 할 수 있는 [조치](#actions)를 참조하십시오.
* 사용량 레코드는 `account_id/resource_group_id/resource_instance_id/consumer_id/plan_id/region/start/end` 서명으로 고유하게 식별됩니다. 사용량 레코드가 처리될 때 서명이 동일한 다른 사용량 레코드는 중복 문제로 거부됩니다.
* 측정 서비스와의 상호작용은 다른 서비스와 결합하지 마십시오. 요청은 인스턴스의 프로비저닝 및 디프로비저닝으로 측정이 시작되고 종료되는 경우에도 개별적으로 처리되어야 합니다.
* 리소스 사용량 데이터는 2-24시간에 한 번씩 측정 서비스에 제출되어야 합니다. 사용량 데이터를 제출하는 빈도는 사용량 메트릭이 변경되는 빈도에 따라 다릅니다.
* 사용량 레코드는 측정이 완료된 시간으로부터 2일 내에 제출되어야 합니다. 이전 사용량 레코드는 거부됩니다.
* 성공적으로 제출하면 응답 코드 201이 리턴됩니다. 다른 응답 코드가 리턴되는 경우, 201 코드를 수신할 때까지 데이터를 업데이트하고 다시 보내십시오.

다음은 사용량을 제출하는 우수 사례입니다.

* 사용자에게 리소스가 이용되는 시간과 해당 계정에 비용이 반영되는 시간이 많이 지연되지 않도록 서비스 제공자가 1시간마다 사용량을 제출하도록 권장합니다.
* 이전 요청에 대한 실제 실패가 있는 경우에만 사용량 레코드 제출을 재시도하십시오. 승인된 사용량 레코드는 다시 제출하지 마십시오.

### 서비스 ID 가이드라인
{: #id-guidelines}

  리소스 정의의 ID 필드를 사용하여 서비스 ID를 지정할 때 다음 가이드라인을 따라야 합니다.
  * ID는 영숫자 문자로 시작되어야 합니다.
  * 문자 A-Z, a-z 및 0-9를 사용하십시오. 사용할 수 있는 특수 문자는 하이픈(-)과 밑줄(_) 뿐입니다.
  * ID에 두 개 이상의 단어가 포함된 경우에는 카멜 케이스 규칙을 따르십시오.
  * ID의 최대 길이가 50자인지 확인하십시오.

### 리소스 이름 가이드라인
{: #resource-name}

  리소스 정의의 resources.name 필드를 사용하여 리소스 이름을 지정할 때 다음 가이드라인을 따라야 합니다.

  * 리소스를 설명하는 단어만 사용하십시오. 예: **스토리지** 또는 **ApiCalls**. 
  * 이름에 두 개 이상의 단어가 포함된 경우에는 카멜 케이스 규칙을 따르십시오.
  * 이름의 첫 번째 문자는 대문자를 사용하십시오.

### 리소스 단위 이름 가이드라인
{: #resource-unti}

  리소스 정의의 resources.unit.name 필드를 사용하여 리소스 단위 이름을 지정할 때 다음 가이드라인을 따라야 합니다.

  * 단위 이름에 한 개의 단어를 사용하고 공백 대신 밑줄(_) 을 사용하여 단어를 구분하십시오. 예를 들어 **API CALL** 대신 **API_CALL**을 지정하십시오.  
  * 이름의 모든 문자를 대문자로 사용하십시오.
  
### 리소스 단위 수량 가이드라인
{: #unit-quantity}

  리소스 정의의 resources.unit.quantityType 필드를 사용하여 리소스 수량 유형을 지정할 때 다음 가이드라인을 따라야 합니다.
  
  * 수량 유형에 한 개의 단어를 사용하십시오.
  * 수량 유형의 모든 문자를 대문자로 사용하십시오.
  
### 집계 ID 가이드라인
{: #aggregation}

  리소스 정의의 aggregations.id 필드를 사용하여 집계 ID를 지정할 때 다음 가이드라인을 따라야 합니다.

  * 수량 유형의 모든 문자를 대문자로 사용하십시오.
  * 공백 대신 밑줄(_) 을 사용하여 단어를 구분하십시오.
  * 이 ID가 aggregations.unit 값으로 시작하거나 이와 일치하는지 확인하십시오. 예를 들어 aggregations.id에 **API_CALLS_PER_MONTH**를 지정하고 aggregations.unit에 **API_CALLS**를 지정하십시오.

### 집계 단위 가이드라인
{: #aggregation-unit}

  리소스 정의의 aggregations.unit 필드를 사용하여 집계 단위를 지정할 때 다음 가이드라인을 따라야 합니다.
   
  * 단위 이름에 단일 양식을 사용하십시오.
  * 단위 이름의 모든 문자를 대문자로 사용하십시오.
  * aggregations.unit에서 지정한 단위 이름이 resources.unit.name 필드에 지정한 집계 단위 이름인지 확인하십시오.
  
### 집계 그룹 가이드라인
{: #aggregation-group}

  리소스 정의의 aggregations.aggregationGroup 필드에 소문자를 사용해야 합니다.
  
### 집계 공식 가이드라인
{: #aggregation-formula}

  리소스 정의의 aggregations.formula 필드의 경우 공식에 산술 연산을 사용하려면 리소스 단위를 하나의 피연산자로 사용하고 공식 함수에서 산술 연산식을 사용해야 합니다. 예를 들어, 다음 공식을 사용하여 바이트를 메가바이트로 변환할 수 있습니다.
  ```
  SUM({BYTE}/1048576)
  ```

## 사용량 제출 REST API
{: #RAPIusesubmit}

{{site.data.keyword.Bluemix_notm}} 사용자는 사용하는 리소스의 양에 따라 요금이 부과됩니다. 예를 들어, 데이터베이스 서비스를 사용하는 사용자는 사용자 애플리케이션이 사용하는 스토리지의 양에 따라 요금이 부과될 수 있습니다.

{{site.data.keyword.Bluemix_notm}} 측정 서비스를 사용하여 사용량 데이터를 보고하려면 오퍼링의 사용량 데이터를 보고하는 측정 서비스 API를 구현하십시오. 추가 세부사항은 [공용 API 문서](https://ibm-bluemix-docs.github.io/usage-submission/)를 참조하십시오.  

측정 서비스 API를 사용하여 시간별 사용량 제출을 자동화해야 합니다. 공용 인터넷에서 액세스할 수 있는 올바른 HTTP 엔드포인트에서 자동화된 제출을 호스팅할 수 있습니다다.
{: tip}

## 사용량 레코드 제출
{: #usage-records}

사용량 레코드는 메트릭의 집계된 값을 구성하는 가장 작은 엔티티입니다. 사용량 레코드는 다음 필드를 사용하여 구성됩니다.

|이름 |설명                                           |
| ------ | ---------------------------------------------------- |
| resource_instance_id | 리소스 인스턴스의 ID입니다.  |
| plan_id | 사용량 레코드가 집계되고 등급이 지정되는 계약입니다.   |
|start  | epoch 이후 사용량을 측정한 시작 시간(밀리초 단위)입니다.  |
|end  | epoch 이후 사용량을 측정한 종료 시간(밀리초 단위)입니다.  |
| region  | 사용량이 측정되는 오퍼링 제공자 지역입니다.  |
| measured_usage  | 값이 있는 측정값의 배열입니다.  |
| consumer_id |선택사항. 이 필드는 이용자 레벨에서 집계가 필요한 경우에만 필요합니다. 오퍼링 제공자만 consumer_id 값을 알고 있습니다. |
{: caption="표1. 사용량 레코드의 필드" caption-side="top"}

API 호출을 사용하여 여러 개의 사용량 레코드를 제출하고 호출당 최대 100개의 사용량 레코드를 제출할 수 있다. 응답 본문에는 모든 사용량 레코드의 승인 상태가 포함됩니다. 201 이외의 모든 상태는 오류 코드와 함께 사용되며 사용량 레코드가 승인되지 않는 이유를 표시합니다. 다음 표에는 상태 코드 및 필수 조치가 나열되어 있습니다.

|상태 코드 | 필수 조치                                       |
| ------ | ---------------------------------------------------- |
|500 | 사용량 레코드를 다시 제출하십시오. 문제점이 지속되면 BSS 측정 팀에 문의하십시오. |
| 400 | 사용량 레코드가 올바른 형식이 아닙니다. 스키마 유효성 검증이 실패했거나 사용량 레코드의 측정값이 올바르지 않거나 시작 및 종료 시간이 프로비저닝과 디프로비저닝 시간 사이에 포함되지 않습니다. 사용량 레코드를 업데이트한 후 다시 제출하십시오.   |
| 424  | 리소스 인스턴스 메타데이터에 몇 가지 문제가 있습니다. 리소스 인스턴스 세부사항을 업데이트하고 사용량 레코드를 다시 제출하십시오.  |
| 404  | 측정 정의를 온보딩하지 않았습니다. BSS 측정 팀과 함께 리소스가 온보딩되어 있는지 확인하고 사용량 레코드를 다시 제출하십시오.  |
| 409  | 사용량 레코드가 중복되어 있습니다. 이 레코드를 다시 제출하지 마십시오. |
{: caption="표2. 상태 코드 및 필수 조치" caption-side="top"}
{: #actions}


  
